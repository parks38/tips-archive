## API 게이트웨이/ 스로틀링 알고리즘  
----
MSA 아키텍쳐와 같이 분산 시스템 환경에서는 네트워크를 통해 데이터를 전달 받는다. 
->  API 는 HTTP, WebSocket 의 프로토콜과 Json, Xml 등 데이터 포맷 방식을 요청 작업의 식별자를 제공하는 것을 말합니다.  

- API 게이트웨이가 필요한 이유?  
API 호출할때 자동화된 프로세스에 연동하여 사용하는데 `자동화 프로세스`라는 특성에 의해 비밀성/가용성 부분에서의 보안적인 요소나 사용량 제어 등을 위해 API 게이트 웨이를 사용합니다.  
API 를 제공할때 꼭 고려해야 하는 것은 API throttling 그리고 관련 알고리즘 입니다. 

### > API 게이트웨이  
- API 제공 시 보안을 위해 고려해야 하는 항목이 많은데 특히 비밀성과 가용성 보장이 중요합니다.  
- API 보안 고려 사항 
    - 취약한 개체 수준 인가
    - 취약한 사용자 인증
    - 과도한 데이터 누출
    - 리소스 부족 및 속도 제한
    - 취약한 기능 수준 인가 
    - 대량 할당
    - 잘못된 보안 구성 
    - 인젝션
    - 부적절한 자산 관리
    - 불충분한 로깅 및 모니터링 

- [예방 방법](https://blog.lgcns.com/2529) 
    - Token 
    - rate limiting/throttling
    - 암호화
    - API Gateway
    - 위협 모델링 

- 보안이 중요한 이유?  
기업은 API를 이용해 서비스를 연결하고 데이터를 전송합니다. API가 손상, 노출 또는 해킹되면 주요 데이터 보안 유출 사고의 원인이 됩니다. 이로 인해 민감한 의료, 금융 및 개인 정보가 노출됩니다. 하지만 모든 데이터가 동일한 것은 아니므로 이를 보호하는 방식도 달라야 합니다. API 보안 접근 방식은 전송되는 데이터의 종류에 따라 달라지게 됩니다.  

API가 제3자의 애플리케이션에 연결되는 경우, 해당 애플리케이션이 정보를 인터넷으로 전송하는 방식을 파악합니다. 위의 예를 적용해보면, 냉장고에 뭐가 있는지 누가 알게 되더라도 별로 신경 쓰이지 않을지도 모릅니다. 그러나 동일한 API를 사용해 사용자의 위치를 추적한다면 얘기는 달라집니다. 
MSA 환경에서는 책임을 별도의 모듈시스템으로 분리하고 API 게이트웨이로 부르는 패턴을 이용한다.   

대부분의 API 구현은 REST(Representational State Transfer) 또는 SOAP(Simple Object Access Protocol) 형식입니다. 
REST API는 HTTP를 사용하며 TLS(Transport Layer Security) 암호화를 지원합니다. TLS는 인터넷 연결을 비공개로 유지하고 두 시스템(서버와 서버 또는 서버와 클라이언트) 간에 전송된 데이터가 암호화되어 수정되지 않았는지 확인하는 표준입니다  

SOAP API는 웹 서비스 보안(WS Security)이라는 기본 제공 프로토콜을 사용합니다. 이러한 프로토콜은 기밀성과 인증에 따른 룰 세트를 정의합니다. SOAP API는 OASIS(Organization for the Advancement of Structured Information Standards) 및 W3C(World Wide Web Consortium)라는 두 가지 국제 표준화 기구에서 정한 표준을 지원합니다. 이는 XML 암호화, XML 서명 및 SAML 토큰을 결합해 인증 및 권한 부여를 확인합니다. 일반적으로 SOAP API는 보다 포괄적인 보안 조치를 갖추고 있는 것으로 높이 평가받고 있지만, 동시에 더 많은 관리가 필요합니다. 이러한 이유로 SOAP API는 민감한 데이터를 처리하는 조직에 권장됩니다.

![API Gateway](/img/gate-way-1.png) 

- 인증과 권한의 자원 접근에 비밀성을 보장
- API 시스템으로 트래픽의 과도한 증가로 비가용적인 상황 제한
   - 속도의 제한/ 부하 분산에 사용 
- 목적 
    - 인증 및 권한 부여
    - 서비스 검색 통합
    - 응답 캐싱 
    - 정책, 회로 차단기, QoS 다시 시도
    - 속도 제한
    - 부하 분산
    - 로깅, 추적, 상관관계
    - 헤더, 쿼리 문자열 및 청구 변환
    - IP 허용 목록 추가  


#### API Throttling 
![API Throttling](/img/gateway.png) 

- 보안성 강화 위해 이용  
    - 버그로 인한 요청량 증가 혹은 악의적인 사용자 DoS(Denial of service) 공격 시도로 인해 가용성 문제인 경우 사용 
- 과금의 조율 위해 사용  
    - CPU/메모리 스케일업, 분산처리 위해 스케일아웃 서버 자원 화장 방법이 있지만 요금 부담이 큼 
    - API 게이트웨이를 통해 스로틀링을 도입하여 회사의 요청속도를 제어하여 SLA 협의 가능하게 함. 

